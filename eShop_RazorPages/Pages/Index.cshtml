@page
@using System.Net;
@using System.Linq
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}

<div class="container">
    <form method="get">
        <div class="input-group mb-3">
            <input type="text" class="form-control" placeholder="Search products" name="searchText">
            <button class="btn btn-outline-secondary" type="submit">Search</button>
        </div>
    </form>

    <div class="d-flex justify-content-between align-items-center">
        <div class="btn-group">
            <a href="/Cart" class="btn btn-sm btn-outline-secondary">View Cart (@Model.ShoppingCart.Sum(i => i.Quantity))</a>
        </div>
    </div>


    <div class="row">
        @foreach (var product in Model.Products)
        {
            <div class="col-md-4">
                <div class="card mb-4 shadow-sm">
                    <img src="@product.Images?.FirstOrDefault()?.Url" class="card-img-top" alt="@product.Name" />
                    <div class="card-body">
                        <h5 class="card-title">@product.Name</h5>
                        <p class="card-text">@product.Description</p>
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="btn-group">
                                <button type="button" class="btn btn-sm btn-outline-secondary">View</button>
                                <form method="post" asp-page-handler="AddToBasket">
                                    <input type="hidden" name="productId" value="@product.ProductId" />
                                    <button type="submit" class="btn btn-sm btn-outline-secondary">Add to Cart</button>
                                </form>

                            </div>
                            <small class="text-muted">@product.Price.ToString("C")</small>
                        </div>
                    </div>
                </div>
            </div>
        }
        <nav aria-label="Page navigation">
            <ul class="pagination">
                @{
                    var prevDisabled = Model.Products.IsFirstPage ? "disabled" : "";
                    var nextDisabled = Model.Products.IsLastPage ? "disabled" : "";
                }

                <li class="page-item @prevDisabled">
                    <a class="page-link" asp-page="./Index" asp-route-pageNumber="@(Model.PageNumber - 1)" asp-route-searchText="@Model.SearchText">Previous</a>
                </li>

                @for (int i = 1; i <= Model.Products.PageCount; i++)
                {
                    <li class="page-item @(Model.PageNumber == i ? "active" : "")">
                        <a class="page-link" asp-page="./Index" asp-route-pageNumber="@i" asp-route-searchText="@Model.SearchText">@i</a>
                    </li>
                }

                <li class="page-item @nextDisabled">
                    <a class="page-link" asp-page-handler="Index" asp-route-pageNumber="@(Model.PageNumber + 1)" asp-route-searchText="@Model.SearchText">Next</a>
                </li>
            </ul>
        </nav>

    </div>
</div>
